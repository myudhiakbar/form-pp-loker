<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact Us By Lokerkesehatanid</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4/animate.min.css"/>
  <style>
  body {
    background: linear-gradient(135deg, #ece9e6, #ffffff);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    font-size: 18px;
  }

  .form-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    padding: 3rem 2.5rem;
    max-width: 500px;
    width: 100%;
    text-align: left;
  }

  h1 {
    font-size: 1.6rem;
    font-weight: 600;
    text-align: center;
    color: #333;
    margin: 0 0 0.5rem;
  }

  p {
    font-size: 0.9rem;
    text-align: center;
    color: #333;
    margin: 0 0 2rem;
  }

  input.form-control,
  textarea.form-control {
    padding: 0.6rem 1rem;
    border-radius: 5px;
    border: 1.4px solid #ccc;
  }

  input.form-control {
    height: 2.5rem;
  }

  .btn {
    margin: 1rem 0;
    padding: 0.6rem 0;
  }

  .btn-primary {
    background: #4e73df;
    border: none;
    transition: all 0.3s ease;
  }

  .btn-primary:hover {
    background: #2e59d9;
  }

  footer {
      margin: 2.5rem 0 0;
      font-size: 1rem;
      text-align: center;
  }

  footer a {
      color: blue;
      text-decoration: none;
  }

  .is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.15rem rgba(220, 53, 69, 0.15);
    display: block;
  }

  .is-valid {
    border-color: #28a745 !important;
    box-shadow: 0 0 0 0.15rem rgba(40, 167, 69, 0.15);
  }

  .invalid-feedback {
    display: none;
    font-size: 0.85rem;
    color: #dc3545;
    margin: 0.8rem 0 0;
    line-height: 1.2;
  }

  @media (max-width: 767px) {
      h1 { font-size: 1.6rem; }
      p { font-size: 1rem; }
      footer { font-size: 0.9rem; }
  }
  </style>
</head>

<body>
  <div class="form-card">
    <h1>Contact Us by Loker Kesehatan ID</h1>
    <p>Ada pertanyaan? Jangan ragu untuk menghubungi kami</p>
      <form id="contactForm">
        <div class="mb-3">
          <label for="nama" class="form-label">Nama <span class="text-danger">*</span></label>
          <input type="text" id="nama" name="nama" class="form-control" required>
          <div class="invalid-feedback">Wajib diisi</div>
        </div>

        <div class="mb-3">
          <label for="no_wa" class="form-label">Nomor WhatsApp <span class="text-danger">*</span></label>
          <input type="text" id="no_wa" name="no_wa" class="form-control" required>
          <div class="invalid-feedback">Wajib diisi angka dan no WA yang valid ya</div>
        </div>

        <div class="mb-3">
          <label for="isi_pesan" class="form-label">Isi Pesan <span class="text-danger">*</span></label>
          <textarea id="isi_pesan" name="isi_pesan" class="form-control" rows="4" required></textarea>
          <div class="invalid-feedback">Wajib diisi</div>
        </div>

        <button type="submit" id="submitBtn" class="btn btn-primary w-100">Kirim Pesan</button>
        <footer>
          <a href="https://loker-kesehatan.my.id">Loker Kesehatan ID</a> Â© 2018 - <span id="year"></span>
        </footer>
      </form>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.getElementById("year").textContent = new Date().getFullYear();

const form = document.getElementById("contactForm");
const namaField = document.getElementById("nama");
const waField = document.getElementById("no_wa");
const pesanField = document.getElementById("isi_pesan");

function updateFieldFeedback(field) {
  let feedback = field.nextElementSibling;
  if (!feedback || !feedback.classList.contains("invalid-feedback")) {
    const parent = field.closest(".mb-3, .form-group") || field.parentElement;
    feedback = parent ? parent.querySelector(".invalid-feedback") : null;
  }
  if (!feedback) return;
  feedback.style.display = field.classList.contains("is-invalid") ? "block" : "none";
}

function validateField(field, condition) {
  if (!condition) {
    field.classList.remove("is-valid");
    field.classList.add("is-invalid");
  } else {
    field.classList.remove("is-invalid");
    field.classList.add("is-valid");
  }
  updateFieldFeedback(field);
}

function validateWA() {
  const wa = waField.value.replace(/\D/g, "");
  waField.value = wa;
  const isValid = /^\d{10,13}$/.test(wa);
  validateField(waField, isValid);
  return isValid;
}

function validateFormFields() {
  let valid = true;
  validateField(namaField, namaField.value.trim() !== "");
  validateField(waField, validateWA());
  validateField(pesanField, pesanField.value.trim() !== "");
  form.querySelectorAll(".form-control").forEach((f) => {
    if (f.classList.contains("is-invalid")) valid = false;
  });
  return valid;
}

waField.addEventListener("input", validateWA);
form.addEventListener("input", (e) => {
  const field = e.target;
  if (field.matches("#nama")) validateField(field, field.value.trim() !== "");
  if (field.matches("#isi_pesan")) validateField(field, field.value.trim() !== "");
});

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  if (!validateFormFields()) {
    const firstInvalid = form.querySelector(".is-invalid");
    if (firstInvalid) firstInvalid.focus();
    return;
  }

  const submitBtn = document.getElementById("submitBtn");
  const nama = namaField.value.trim();
  const wa = waField.value.trim();
  const isiPesan = pesanField.value.trim();

  const confirmSend = await Swal.fire({
    title: 'Simpan pesan sekarang?',
    text: 'Pastikan data yang kamu isi sudah benar.',
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'OK, lanjutkan',
    cancelButtonText: 'Batal',
    reverseButtons: true
  });

  if (!confirmSend.isConfirmed) return;

  Swal.fire({
    title: 'Menyimpan pesan...',
    text: 'Mohon tunggu sebentar.',
    allowOutsideClick: false,
    allowEscapeKey: false,
    didOpen: () => Swal.showLoading()
  });

  submitBtn.disabled = true;
  submitBtn.innerHTML = `
    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
    Mengirim...
  `;

  const data = { nama, wa, isiPesan };
  const scriptURL = "https://script.google.com/macros/s/AKfycbztu0VlT9aVNgqxLLm8e687FypkgYFPYUsqlThUH2R8d8sZNGg9P2Vn72dfSuYkWnc/exec";
  const ADMIN_WA = "6287713314496";

  try {
    const res = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify(data),
    });
    const result = await res.json();

    if (result.result === "success") {
      const pesan = `Isi pesan :\n`;
      const pesan = `Hai admin @lokerkesehatanid, nama saya ${data.nama}\n` +
        `wa : ${data.wa}\n\n` +
        `${data.isiPesan}`;
      const pesanUrl = `https://wa.me/${ADMIN_WA}?text=${encodeURIComponent(pesan)}`;

      Swal.fire({
        icon: 'success',
        title: 'Pesan berhasil disimpan!',
        text: 'Klik tombol OK untuk kirim ke admin via WhatsApp',
        confirmButtonText: 'OK, kirim ke admin'
      }).then(() => {
        window.location.href = pesanUrl;
        form.reset();
        form.querySelectorAll(".form-control").forEach((field) => {
          field.classList.remove("is-valid", "is-invalid");
        });
      });

    } else {
      Swal.fire({
        icon: 'error',
        title: 'Gagal menyimpan pesan!',
        text: result.message || 'Terjadi kesalahan di server.',
        confirmButtonText: 'OK'
      });
    }

  } catch (err) {
    Swal.fire({
      icon: 'error',
      title: 'Terjadi kesalahan!',
      text: err.message,
      confirmButtonText: 'OK'
    });
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = `Kirim Pesan`;
  }
});
</script>
</body>
</html>
