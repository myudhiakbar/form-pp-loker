<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Order PP Loker</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4/animate.min.css" rel="stylesheet" />

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        font-size: 16px;
        background: linear-gradient(135deg, #ece9e6, #ffffff);
        color: #000000;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 3.2px;
      }

      .form-container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        width: 100%;
        max-width: 500px;
      }

      h2 {
        color: #01239e;
        font-weight: 600;
        font-size: 1.8rem;
        text-align: center;
        margin: 1.5rem 0 2rem;
      }

      input.form-control,
      select.form-select {
        height: 45px;
        padding: 0.6rem 1rem;
        font-size: 1rem;
        border-radius: 5px;
        border: 1px solid #ccc;
      }

      input[type="file"].form-control {
        height: auto;
        padding: 0.5rem;
      }

      .rekening {
        margin: 2rem 0 0;
      }

      .rekening p {
        margin: 0 0 0.5rem;
      }

      .btn-submit {
        background: linear-gradient(45deg, #1237f3, #223fe6);
        border: none;
        color: #ffffff;
        padding: 0.7rem 0;
        margin: 1rem 0;
      }

      .btn-submit:hover {
        opacity: 0.9;
        color: #ffffff;
      }

      footer {
        margin: 2.5rem 0 0;
        font-size: 1rem;
        text-align: center;
      }

      footer a {
        color: blue;
        text-decoration: none;
      }

      .is-invalid {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.15rem rgba(220, 53, 69, 0.15);
      }

      .is-valid {
        border-color: #28a745 !important;
        box-shadow: 0 0 0 0.15rem rgba(40, 167, 69, 0.15);
      }

      .invalid-feedback {
        display: none;
        font-size: 0.85rem;
        color: #dc3545;
        margin: 0.7rem 0 0;
        line-height: 1.2;
      }

      /* DROPZONE UPLOAD */
      .dropzone-upload {
        border: 2px dashed #6c757d;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        transition: 0.25s ease;
        background: #f8f9fa;
      }

      .dropzone-upload:hover {
        background: #eef1f7;
        border-color: #0d6efd;
      }

      .dropzone-upload.dragover {
        background: #e2e6ff;
        border-color: #0d6efd;
      }

      .dropzone-icon {
        font-size: 40px;
        color: #0d6efd;
      }

      .dropzone-text {
        font-size: 15px;
        color: #6c757d;
        margin-top: 10px;
      }

      #filePreviewBox {
        display: none;
        background: #f1f3f5;
        border: 1px solid #ced4da;
        border-radius: 8px;
        padding: 12px;
        margin-top: 10px;
      }

      #removeBukti {
        cursor: pointer;
        color: #ff4d4d;
        font-size: 14px;
      }

      @media (max-width: 767px) {
        h2 {
          font-size: 1.4rem;
        }
        footer {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>

<body>
  <div class="container-fluid py-4">
    <div class="form-container mx-auto">
      <h2>Konfirmasi Pembayaran<br>Paid Promote / Iklan Loker Kesehatan ID</h2>
      <form id="orderForm">
        <div class="mb-3">
          <label for="nama" class="form-label">Nama <span class="text-danger">*</span></label>
          <input type="text" id="nama" name="nama" class="form-control" placeholder="Nama Pengiklan" required>
          <div class="invalid-feedback">Wajib diisi</div>
        </div>

        <div class="mb-3">
          <label for="produk" class="form-label">Pilih Paket <span class="text-danger">*</span></label>
          <select name="produk" id="produk" class="form-select" required>
            <option value="">‚è≥ Memuat daftar paket...</option>
          </select>
          <div class="invalid-feedback">Silakan pilih paket</div>
        </div>

        <div class="mb-3">
          <label for="namaRek" class="form-label">Atas Nama Rekening <span class="text-danger">*</span></label>
          <input type="text" id="namaRek" name="namaRek" class="form-control" placeholder="Pemilik Rekening" required>
          <div class="invalid-feedback">Wajib diisi</div>
        </div>

          <!-- DROPZONE -->
          <div class="mb-3">
            <label class="form-label">Upload Bukti Transfer (JPEG/PNG) <span class="text-danger">* (Max file size: 2MB)</span></label>

            <div class="dropzone-upload" id="dropzoneBukti">
            <div class="dropzone-icon">üì§</div>
            <div class="dropzone-text" id="dropzoneText">Klik untuk upload atau seret file disini</div>
            </div>

            <input type="file" id="bukti" name="bukti" class="form-control d-none" accept="image/jpeg,image/png" required />
            <div class="invalid-feedback">Harap upload bukti transfer</div>

            <div id="filePreviewBox">
              <div class="d-flex justify-content-between">
		<div>
                  <strong id="previewName"></strong><br />
                  <small id="previewSize"></small>
              </div>
                <span id="removeBukti">‚ùå Hapus</span>
              </div>
            </div>
          </div>

        <div class="rekening mb-4">
          <p>‚û°Ô∏è BCA: <span id="bca">5800244716</span>
            <button type="button" class="copy-btn btn btn-sm btn-light" onclick="copyText('bca')">üìã</button></p>
          <p>‚û°Ô∏è MANDIRI: <span id="mandiri">9000032618168</span>
            <button type="button" class="copy-btn btn btn-sm btn-light" onclick="copyText('mandiri')">üìã</button></p>
          <p>a.n. Muhammad Yudhi Akbar</p>
        </div>

        <button type="submit" id="submitBtn" class="btn btn-submit w-100">üì§ Kirim Pembayaran</button>

        <footer>
          <a href="https://loker-kesehatan.my.id">Loker Kesehatan ID</a> ¬© 2018 - <span id="year"></span>
        </footer>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.getElementById("year").textContent=new Date().getFullYear();

const form=document.getElementById("orderForm");
const namaField=document.getElementById("nama");
const produkField=document.getElementById("produk");
const namaRekField=document.getElementById("namaRek");
const buktiField=document.getElementById("bukti");

const dz=document.getElementById("dropzoneBukti");
const dzText=document.getElementById("dropzoneText");
const previewBox=document.getElementById("filePreviewBox");
const previewName=document.getElementById("previewName");
const previewSize=document.getElementById("previewSize");
const removeBtn=document.getElementById("removeBukti");

const WEBAPP_URL="https://script.google.com/macros/s/AKfycbwnhTNcpCmCsgouD6RgiF7LH8Qrx_xAr6A56p_THvmpG-4U9frxsLVgkZ5LF9_YSbJeQw/exec";
const ADMIN_WA="6287713314496";

function validateField(field,condition){
  field.classList.toggle("is-invalid",!condition);
  field.classList.toggle("is-valid",condition);
  const f=field.parentElement.querySelector(".invalid-feedback");
  if(f)f.style.display=condition?"none":"block";
}

function validateFormFields(){
  validateField(namaField,namaField.value.trim()!=="");
  validateField(produkField,produkField.value.trim()!=="");
  validateField(namaRekField,namaRekField.value.trim()!=="");
  validateField(buktiField,!!buktiField.files[0]);
  return !form.querySelector(".is-invalid");
}

form.addEventListener("input",e=>{
  const f=e.target;
  if(f===namaField)validateField(f,f.value.trim()!=="");
  if(f===produkField)validateField(f,f.value.trim()!=="");
  if(f===namaRekField)validateField(f,f.value.trim()!=="");
  if(f===buktiField)validateField(f,!!f.files[0]);
});

async function loadProduk(){
  const r=await fetch(WEBAPP_URL);
  const d=await r.json();
  produkField.innerHTML='<option value="">-- Pilih Paket --</option>';
  if(d.result==="success")d.produk.forEach(p=>{
    const o=document.createElement("option");
    o.value=p;o.textContent=p;produkField.appendChild(o);
  });
}

function toBase64(f){
  return new Promise((r,j)=>{
    const fr=new FileReader();
    fr.onload=()=>r(fr.result.split(",")[1]);
    fr.onerror=j;
    fr.readAsDataURL(f);
  });
}

dz.onclick=()=>buktiField.click();

dz.ondragover=e=>{e.preventDefault();dz.classList.add("dragover")};
dz.ondragleave=()=>dz.classList.remove("dragover");
dz.ondrop=e=>{
  e.preventDefault();
  dz.classList.remove("dragover");
  buktiField.files=e.dataTransfer.files;
  triggerPreview();
};

buktiField.onchange=triggerPreview;

function triggerPreview(){
  const f=buktiField.files[0];
  if(!f)return;
  previewBox.style.display="block";
  previewName.textContent=f.name;
  previewSize.textContent=(f.size/1024).toFixed(1)+" KB";
  dzText.textContent="1 file terpilih";
}

removeBtn.onclick=()=>{
  buktiField.value="";
  previewBox.style.display="none";
  dzText.textContent="Klik atau seret file";
  validateField(buktiField,false);
};

form.onsubmit=async e=>{
  e.preventDefault();
  if(!validateFormFields())return;

  Swal.fire({title:"Menyimpan...",allowOutsideClick:false,showConfirmButton:false,didOpen:()=>Swal.showLoading()});

  const file=buktiField.files[0];
  const payload={
    nama:namaField.value,
    produk:produkField.value,
    namaRek:namaRekField.value,
    bukti:await toBase64(file),
    buktiNama:file.name
  };

  const r=await fetch(WEBAPP_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
  const res=await r.json();
  Swal.close();

  if(res.result==="success"){
    const msg=`Halo admin, saya sudah transfer:\nNama: ${payload.nama}\nProduk: ${payload.produk}\nRekening: ${payload.namaRek}\nBukti: ${res.fileUrl||"-"}`;
    window.open(`https://wa.me/${ADMIN_WA}?text=${encodeURIComponent(msg)}`,"_blank");
    form.reset();
    previewBox.style.display="none";
    dzText.textContent="Klik atau seret file";
    document.querySelectorAll(".is-valid").forEach(el=>el.classList.remove("is-valid"));
  }else{
    Swal.fire("Gagal",res.message||"Error","error");
  }
};

window.addEventListener("DOMContentLoaded",loadProduk);
</script>
</body>
</html>
